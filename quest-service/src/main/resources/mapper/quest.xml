<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.jigubangbang.repository.QuestMapper">
    <select id="getQuests" resultType="com.jigubangbang.quest_service.model.QuestListDto" parameterType="map">
        SELECT 
            id,
            type,
            category,
            title,
            difficulty,
            xp,
            is_seasonal,
            season_start,
            season_end,
            status,
            created_at
        FROM quest
        <where>
            <!--카테고리 0: 전체-->
            <if test="category != null and category != 0">
                category = #{category}
            </if>

            <!--난이도-->
            <if test="difficulty != null and difficulty != ''">
                difficulty = #{difficulty}
            </if>
        </where>
        <choose>
            <when test="sortOption == 'latest">
                ORDER BY created_at DESC
            </when>

            <when test="sortOption == 'xp'">
                ORDER BY xp DESC
            </when>

            <otherwise>
                ORDER BY id ASC
            </otherwise>
        </choose>
        LIMIT #{questPerPage} OFFSET #{offset}
    </select>

    <select id="countQuests" resultType="int">
        SELECT COUNT(*) FROM quest
    </select>
  

</mapper>